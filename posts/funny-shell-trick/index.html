<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="pancho horrillo"><meta name=description content="Rantings about life."><meta name=generator content="Hugo 0.118.2"><title>Funny Shell trick &#183; …soul, as in software?</title><link rel="shortcut icon" href=https://blog.pancho.name/images/favicon.ico><link rel=stylesheet href=https://blog.pancho.name/css/spectre.min.css><link rel=stylesheet href=https://blog.pancho.name/css/style.css><link rel=stylesheet href=https://blog.pancho.name/css/highlight.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css><link href rel=alternate type=application/rss+xml title="…soul, as in software?"><meta property="og:title" content="Funny Shell trick"><meta property="og:description" content="While sorting out a debian .bashrc file, I came across to this construct:
export HISTCONTROL=$HISTCONTROL${HISTCONTROL+,}ignoredups I found interesting the ${HISTCONTROL+,} construct, which will evaluate to a comma (,) if HISTCONTROL is defined, to the empty string otherwise (I checked).
It is useful to enrich (i.e., add while preserving the previous values) variables with new values that must be comma-separated.
I&rsquo;ll try to explain this further.
Let&rsquo;s assume that we have an enviroment variable FOO that controls the behaviour of some program."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.pancho.name/posts/funny-shell-trick/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2013-08-17T20:17:00+02:00"><meta property="article:modified_time" content="2013-08-17T20:17:00+02:00"><meta itemprop=name content="Funny Shell trick"><meta itemprop=description content="While sorting out a debian .bashrc file, I came across to this construct:
export HISTCONTROL=$HISTCONTROL${HISTCONTROL+,}ignoredups I found interesting the ${HISTCONTROL+,} construct, which will evaluate to a comma (,) if HISTCONTROL is defined, to the empty string otherwise (I checked).
It is useful to enrich (i.e., add while preserving the previous values) variables with new values that must be comma-separated.
I&rsquo;ll try to explain this further.
Let&rsquo;s assume that we have an enviroment variable FOO that controls the behaviour of some program."><meta itemprop=datePublished content="2013-08-17T20:17:00+02:00"><meta itemprop=dateModified content="2013-08-17T20:17:00+02:00"><meta itemprop=wordCount content="175"><meta itemprop=keywords content="bash,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Funny Shell trick"><meta name=twitter:description content="While sorting out a debian .bashrc file, I came across to this construct:
export HISTCONTROL=$HISTCONTROL${HISTCONTROL+,}ignoredups I found interesting the ${HISTCONTROL+,} construct, which will evaluate to a comma (,) if HISTCONTROL is defined, to the empty string otherwise (I checked).
It is useful to enrich (i.e., add while preserving the previous values) variables with new values that must be comma-separated.
I&rsquo;ll try to explain this further.
Let&rsquo;s assume that we have an enviroment variable FOO that controls the behaviour of some program."><meta name=twitter:site content="@https://www.twitter.com/panchoHorrillo"></head><body onload=setPixelFont()><div class="container p-fixed" style=z-index:3><nav class="navbar m-2 p-2 s-rounded shadow bg-primary"><section class=navbar-section><button class="btn btn-action btn-primary s-circle text-gray" id=pixelfont-toggle><i class="fas fa-robot fa-lg"></i></button></section><section class=navbar-section><a class="btn btn-primary" href=https://blog.pancho.name/>Home</a>
<a class="btn btn-primary mx-2" href=/about/>About</a>
<a class="btn btn-accent" href target=_blank><i class="fas fa-rss fa-lg"></i></a></section></nav></div><section class="container grid-md"><div class=columns><article class="container p-centered mt-space"><header><h2 class=text-center>Funny Shell trick</h2><h6 class="text-gray text-italic"></h6></header><section class=my-gap><p>While sorting out a debian <code>.bashrc</code> file, I came across to this construct:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>export HISTCONTROL<span style=color:#f92672>=</span>$HISTCONTROL<span style=color:#e6db74>${</span>HISTCONTROL+,<span style=color:#e6db74>}</span>ignoredups
</span></span></code></pre></div><p>I found interesting the <code>${HISTCONTROL+,}</code> construct, which will evaluate to a
comma (<code>,</code>) if <code>HISTCONTROL</code> is defined, to the empty string otherwise (I
checked).</p><p>It is useful to enrich (i.e., add while preserving the previous values)
variables with new values that must be comma-separated.</p><p>I&rsquo;ll try to explain this further.</p><p>Let&rsquo;s assume that we have an enviroment variable <code>FOO</code> that controls the
behaviour of some program. We want to make sure that the <code>FOO</code> var holds the
value <code>bar</code>, but we don’t know if some other scriptlet in the chain has
already set some other value(s) to this var. So, in order to preserve
possible preset values for <code>FOO</code>, we do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>export FOO<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>FOO<span style=color:#e6db74>}${</span>FOO+,<span style=color:#e6db74>}</span>myfoo  <span style=color:#75715e>#¹</span>
</span></span></code></pre></div><p>There are two obvious cases:</p><p>a) <code>FOO</code> wasn’t previously set, hence <code>FOO=myfoo</code> after ¹ is executed</p><p>b) <code>FOO</code> was previously set with, say <code>FOO=bar,baz</code>. Then, after ¹ is
executed, <code>FOO</code> will be <code>FOO=bar,baz,myfoo</code>. Note the comma between <code>baz</code> and
<code>myfoo</code>. That’s the doing of <code>${FOO+,}</code>.</p><code class=text-bold>Tags</code>
<a class="chip text-accent" href=https://blog.pancho.name/tags/bash>bash</a></section><div class="divider my-gap"></div><footer class="col-12 d-inline-block"><span class=float-left><button class="btn btn-action btn-accent shadow s-circle" onclick=window.history.back()><i class="fas fa-arrow-left"></i></button></span>
<span class=float-right><div class="text-right float-left mx-2"><span class=text-dark>pancho horrillo</span><br><span class=text-gray>I do things with computers.</span></div><figure class="avatar avatar-lg"><img id=profile></figure></span></footer></article><footer class="container p-centered text-center my-gap"><div class=container><a class=symbol href=https://www.bbva.com/en/guest-authors/pancho-horrillo/ target=_blank><i class="fab fa-bbva"></i></a>
<a class=symbol href=mailto:pancho%20at%20pancho%20dot%20name target=_blank><i class="fas fa-envelope"></i></a>
<a class=symbol href=https://www.github.com/panchoh target=_blank><i class="fab fa-github"></i></a>
<a class=symbol href=https://www.linkedin.com/in/pancho-horrillo target=_blank><i class="fab fa-linkedin"></i></a>
<a class=symbol href=https://www.twitter.com/panchoHorrillo target=_blank><i class="fab fa-twitter"></i></a></div><small class=text-gray>© 2007-2023 pancho horrillo</small></footer></div></section><script src=//ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<script src=https://blog.pancho.name/js/main.js></script>
<script src=https://blog.pancho.name/js/highlight.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>