<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="pancho horrillo"><meta name=description content="Rantings about life."><meta name=generator content="Hugo 0.118.2"><title>Workaround for bad interaction between pipenv and pyenv &#183; …soul, as in software?</title><link rel="shortcut icon" href=https://blog.pancho.name/images/favicon.ico><link rel=stylesheet href=https://blog.pancho.name/css/spectre.min.css><link rel=stylesheet href=https://blog.pancho.name/css/style.css><link rel=stylesheet href=https://blog.pancho.name/css/highlight.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css><link href rel=alternate type=application/rss+xml title="…soul, as in software?"><meta property="og:title" content="Workaround for bad interaction between pipenv and pyenv"><meta property="og:description" content="I use Arch Linux these days, and it is a &lsquo;bleeding-edge&rsquo; distro, which means that, typically, only the latest stable versions of upstream packages are available.
Recently, python 3.8 entered the arch repos, replacing python 3.7 altogether. Note that python 2.7 is still available, although I expect that it will be dropped on January.
So, if you are working on a project that depends on python 3.7, you can leverage pyenv, which is readily available from the Community repo."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.pancho.name/posts/workaround-for-issue-with-pipenv-pyenv/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-11-17T11:58:00+01:00"><meta property="article:modified_time" content="2019-11-17T11:58:00+01:00"><meta itemprop=name content="Workaround for bad interaction between pipenv and pyenv"><meta itemprop=description content="I use Arch Linux these days, and it is a &lsquo;bleeding-edge&rsquo; distro, which means that, typically, only the latest stable versions of upstream packages are available.
Recently, python 3.8 entered the arch repos, replacing python 3.7 altogether. Note that python 2.7 is still available, although I expect that it will be dropped on January.
So, if you are working on a project that depends on python 3.7, you can leverage pyenv, which is readily available from the Community repo."><meta itemprop=datePublished content="2019-11-17T11:58:00+01:00"><meta itemprop=dateModified content="2019-11-17T11:58:00+01:00"><meta itemprop=wordCount content="403"><meta itemprop=keywords content="python,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Workaround for bad interaction between pipenv and pyenv"><meta name=twitter:description content="I use Arch Linux these days, and it is a &lsquo;bleeding-edge&rsquo; distro, which means that, typically, only the latest stable versions of upstream packages are available.
Recently, python 3.8 entered the arch repos, replacing python 3.7 altogether. Note that python 2.7 is still available, although I expect that it will be dropped on January.
So, if you are working on a project that depends on python 3.7, you can leverage pyenv, which is readily available from the Community repo."><meta name=twitter:site content="@https://www.twitter.com/panchoHorrillo"></head><body onload=setPixelFont()><div class="container p-fixed" style=z-index:3><nav class="navbar m-2 p-2 s-rounded shadow bg-primary"><section class=navbar-section><button class="btn btn-action btn-primary s-circle text-gray" id=pixelfont-toggle><i class="fas fa-robot fa-lg"></i></button></section><section class=navbar-section><a class="btn btn-primary" href=https://blog.pancho.name/>Home</a>
<a class="btn btn-primary mx-2" href=/about/>About</a>
<a class="btn btn-accent" href target=_blank><i class="fas fa-rss fa-lg"></i></a></section></nav></div><section class="container grid-md"><div class=columns><article class="container p-centered mt-space"><header><h2 class=text-center>Workaround for bad interaction between pipenv and pyenv</h2><h6 class="text-gray text-italic"></h6></header><section class=my-gap><p>I use <a href=https://archlinux.org>Arch Linux</a> these days, and it is a &lsquo;bleeding-edge&rsquo; distro, which means
that, typically, only the latest stable versions of upstream packages are
available.</p><p>Recently, <code>python 3.8</code> <a href=https://www.archlinux.org/packages/extra/x86_64/python/>entered the arch repos</a>, replacing <code>python 3.7</code>
altogether. Note that <a href=https://www.archlinux.org/packages/extra/x86_64/python2/><code>python 2.7</code></a> is still available, although I expect that
it will be <a href=https://pythonclock.org/>dropped on January</a>.</p><p>So, if you are working on a project that depends on <code>python 3.7</code>, you can
leverage <a href=https://github.com/pyenv/pyenv>pyenv</a>, which is readily <a href=https://www.archlinux.org/packages/community/any/pyenv/>available</a> from the Community repo.</p><p><code>pyenv</code> requires a modicum of setup, which is described <a href=https://github.com/pyenv/pyenv#basic-github-checkout>here</a>.</p><p><code>pipenv</code> supports working together with <code>pyenv</code>, and will detect if the
required <code>python</code> version in your <code>Pipfile</code> is not installed in your system,
and prompt you to install it on your behalf, via <code>pyenv</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ tail -2 Pipfile
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>requires<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>python_version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;3.7&#34;</span>
</span></span><span style=display:flex><span>$ pipenv sync
</span></span><span style=display:flex><span>Warning: Python 3.7 was not found on your system…
</span></span><span style=display:flex><span>Would you like us to install CPython 3.7.5 with pyenv? <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>Installing CPython 3.7.5 with pyenv <span style=color:#f92672>(</span>this may take a few minutes<span style=color:#f92672>)</span>…
</span></span><span style=display:flex><span>✔ Success!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Warning: The Python you just installed is not available on your PATH, apparently.
</span></span></code></pre></div><p>Oops! Something is not working here, even though the <code>PATH</code> is setup OK.</p><p>It is a <a href=https://github.com/pypa/pipenv/issues/3551>known issue</a> with <code>pipenv</code> that is <a href=https://github.com/pypa/pipenv/issues/3551#issuecomment-485507674>possibly fixed</a> in <code>master</code>, but
definitely not in the <a href=https://github.com/pypa/pipenv/releases/tag/v2018.11.26>latest release</a>, which, as of today, is almost a year
old. Be patient, <a href=https://github.com/pypa/pipenv/issues/3742#issuecomment-492100711>a lot</a> has been happening, but work is underway.</p><p>We can work around this issue by ensuring that the required <code>python</code> version
is installed, selecting it for the current project, and forcing <code>pipenv</code> to
use it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ pyenv install 3.7.5
</span></span><span style=display:flex><span>Downloading Python-3.7.5.tar.xz...
</span></span><span style=display:flex><span>-&gt; https://www.python.org/ftp/python/3.7.5/Python-3.7.5.tar.xz
</span></span><span style=display:flex><span>Installing Python-3.7.5...
</span></span><span style=display:flex><span>Installed Python-3.7.5 to /home/pancho/.pyenv/versions/3.7.5
</span></span><span style=display:flex><span>$ cd someproject
</span></span><span style=display:flex><span><span style=color:#75715e># This creates a =.python-version= file containing the selected version</span>
</span></span><span style=display:flex><span>$ pyenv local 3.7.5
</span></span><span style=display:flex><span>$ pipenv --python <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>pyenv root<span style=color:#66d9ef>)</span><span style=color:#e6db74>/shims/python&#34;</span> sync
</span></span><span style=display:flex><span>... Works OK now ...
</span></span></code></pre></div><p>This can be inconvenient if <code>pipenv</code> is being run from a <code>Makefile</code> that we
don&rsquo;t want to edit. Fortunately, there is a workaround for that, too.</p><p>Instead of using the <code>--python</code> option to <code>pipenv</code>, we can just define the env
var <code>PIPENV_PYTHON</code>, which controls the same behaviour (seen <a href=https://github.com/pypa/pipenv/issues/3855#issuecomment-512205338>here</a>).</p><p>To sum up:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ export PIPENV_PYTHON<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>pyenv root<span style=color:#66d9ef>)</span><span style=color:#e6db74>/shims/python&#34;</span>
</span></span><span style=display:flex><span>$ pyenv install 3.7.5
</span></span><span style=display:flex><span>... yadda yadda ...
</span></span><span style=display:flex><span>$ pyenv local 3.7.5
</span></span><span style=display:flex><span>$ pipenv sync
</span></span></code></pre></div><p>As a final note, we can add the definition of <code>PIPENV_PYTHON</code> to your shell
init script, so we don&rsquo;t have to bother to set it up everytime this comes
across.</p><code class=text-bold>Tags</code>
<a class="chip text-accent" href=https://blog.pancho.name/tags/python>python</a></section><div class="divider my-gap"></div><footer class="col-12 d-inline-block"><span class=float-left><button class="btn btn-action btn-accent shadow s-circle" onclick=window.history.back()><i class="fas fa-arrow-left"></i></button></span>
<span class=float-right><div class="text-right float-left mx-2"><span class=text-dark>pancho horrillo</span><br><span class=text-gray>I do things with computers.</span></div><figure class="avatar avatar-lg"><img id=profile></figure></span></footer></article><footer class="container p-centered text-center my-gap"><div class=container><a class=symbol href=https://www.bbva.com/en/guest-authors/pancho-horrillo/ target=_blank><i class="fab fa-bbva"></i></a>
<a class=symbol href=mailto:pancho%20at%20pancho%20dot%20name target=_blank><i class="fas fa-envelope"></i></a>
<a class=symbol href=https://www.github.com/panchoh target=_blank><i class="fab fa-github"></i></a>
<a class=symbol href=https://www.linkedin.com/in/pancho-horrillo target=_blank><i class="fab fa-linkedin"></i></a>
<a class=symbol href=https://www.twitter.com/panchoHorrillo target=_blank><i class="fab fa-twitter"></i></a></div><small class=text-gray>© 2007-2023 pancho horrillo</small></footer></div></section><script src=//ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<script src=https://blog.pancho.name/js/main.js></script>
<script src=https://blog.pancho.name/js/highlight.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>